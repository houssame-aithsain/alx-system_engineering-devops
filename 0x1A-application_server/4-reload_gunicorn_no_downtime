#!/bin/bash

# Find the master Gunicorn process ID (PID)
MASTER_PID=$(ps aux | grep 'gunicorn --bind 0.0.0.0:8001' | grep -v grep | awk '{print $2}')

if [ -z "$MASTER_PID" ]; then
    echo "Gunicorn master process not found."
    exit 1
fi

echo "Found Gunicorn master PID: $MASTER_PID"

# Reload Gunicorn gracefully
kill -HUP $MASTER_PID

# Wait a bit for the new workers to be spawned
sleep 5

# Verify that new workers are running
ps aux | grep 'gunicorn --bind 0.0.0.0:8001' | grep -v grep

echo "Gunicorn reloaded successfully."
